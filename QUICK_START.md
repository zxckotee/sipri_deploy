# Быстрый старт

## Автоматическая инициализация БД

При первом запуске контейнеров база данных автоматически инициализируется:

1. ✅ Создаются базы данных `sipri_crm` и `app_sipri`
2. ✅ Создаются пользователи с правами
3. ✅ **Автоматически импортируется `dump.sql`**, если БД пуста

## Запуск

```bash
cd /home/fsociety/sipri_deploy

# Первый запуск (с импортом дампа)
docker-compose down -v  # Удаляет старые volumes (если есть)
docker-compose up -d     # Создаёт и запускает контейнеры

# Проверка логов
docker-compose logs db | grep -i "импорт\|import\|table"
```

## Что происходит

1. **Контейнер БД запускается** и выполняет скрипт `db/init/01-init.sh`
2. Скрипт проверяет, есть ли таблицы в `sipri_crm`
3. Если таблиц нет → импортирует `dump.sql` с автоматической заменой имени БД
4. Если таблицы есть → пропускает импорт

## Проверка результата

После запуска проверьте логи:

```bash
docker-compose logs db
```

Вы должны увидеть:
- `✓ База данных sipri_crm пуста. Начинаю импорт dump.sql...`
- `✓ Дамп успешно импортирован! Создано таблиц: XX`

## Если нужно переимпортировать

```bash
# Удалить volumes и пересоздать
docker-compose down -v
docker-compose up -d
```

## Структура

- `db/init/dump.sql` - SQL дамп RiseCRM (должен быть в этой директории)
- `db/init/01-init.sh` - скрипт автоматической инициализации
- `docker-compose.yml` - монтирует `db/init/` в контейнер БД

**Примечание:** Если у вас есть `dump.sql` в корне проекта, убедитесь, что он скопирован в `db/init/`:
```bash
cp dump.sql db/init/dump.sql
```

## После импорта

После успешного импорта:
- ✅ База содержит все таблицы RiseCRM (префикс `bro_`)
- ✅ Приложение SIPRI должно работать
- ✅ Можно запустить миграции CodeIgniter для таблиц SIPRI (если нужно)
