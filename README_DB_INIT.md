# Инициализация базы данных

## Автоматический импорт дампа

При первой инициализации контейнера БД автоматически выполняется:

1. Создание баз данных `sipri_crm` и `app_sipri`
2. Создание пользователей и выдача прав
3. **Автоматический импорт `dump.sql`**, если база данных `sipri_crm` пуста

## Как это работает

Скрипт `db/init/01-init.sh`:
- Проверяет количество таблиц в базе `sipri_crm`
- Если таблиц нет (база пуста), импортирует `dump.sql`
- Заменяет имя базы данных `cp91572_1` на `sipri_crm` автоматически

## Важно

⚠️ **Импорт происходит только при первой инициализации** (когда volume БД пустой).

Если нужно переимпортировать дамп:
```bash
docker-compose down -v  # Удаляет volumes
docker-compose up -d    # Создаёт заново с импортом
```

## Структура файлов

- `db/init/dump.sql` - SQL дамп с полной схемой RiseCRM (должен быть скопирован сюда)
- `db/init/01-init.sh` - скрипт инициализации БД
- `docker-compose.yml` - монтирует директорию `db/init/` в контейнер БД

**Важно:** Файл `dump.sql` должен находиться в директории `db/init/`. Если у вас есть `dump.sql` в корне проекта, скопируйте его:
```bash
cp dump.sql db/init/dump.sql
```

## После импорта

После успешного импорта дампа:
1. База данных содержит все таблицы RiseCRM с префиксом `bro_`
2. Можно запустить миграции CodeIgniter для таблиц SIPRI (префикс `sipri_`)
3. Приложение должно работать корректно
